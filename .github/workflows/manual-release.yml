# DEPRECATED: This workflow has been consolidated into release.yml
#
# npm trusted publishing only allows ONE workflow file to be registered as a
# trusted publisher. Since our npm settings are configured for release.yml,
# all publishing must go through that workflow.
#
# Please use the CI/CD workflow (release.yml) instead:
# 1. Go to Actions tab
# 2. Select "CI/CD" workflow
# 3. Click "Run workflow"
# 4. Choose your release_mode and bump_type
#
# See: docs/case-studies/issue-96/npm-trusted-publishing-failure.md
#
# This file is kept for reference but will show a deprecation warning.

name: Manual Release (DEPRECATED)

on:
  workflow_dispatch:
    inputs:
      release_mode:
        description: 'Release mode'
        required: true
        type: choice
        default: 'instant'
        options:
          - instant
          - changeset-pr
      bump_type:
        description: 'Release type'
        required: true
        type: choice
        options:
          - patch
          - minor
          - major
      description:
        description: 'Release description (optional)'
        required: false
        type: string

jobs:
  deprecation-warning:
    name: Deprecation Warning
    runs-on: ubuntu-latest
    steps:
      - name: Show deprecation warning
        run: |
          echo "::warning::This workflow is DEPRECATED and will not publish successfully."
          echo "::warning::npm trusted publishing only allows one workflow file (release.yml) as trusted publisher."
          echo "::warning::Please use the CI/CD workflow (release.yml) instead:"
          echo "::warning::1. Go to Actions tab"
          echo "::warning::2. Select 'CI/CD' workflow"
          echo "::warning::3. Click 'Run workflow'"
          echo "::warning::4. Choose your release_mode (${{ github.event.inputs.release_mode }}) and bump_type (${{ github.event.inputs.bump_type }})"
          echo ""
          echo "See: docs/case-studies/issue-96/npm-trusted-publishing-failure.md"
          echo ""
          echo "Triggering the CI/CD workflow with your inputs..."

      - name: Trigger CI/CD workflow
        uses: actions/github-script@v7
        with:
          github-token: ${{ secrets.GITHUB_TOKEN }}
          script: |
            await github.rest.actions.createWorkflowDispatch({
              owner: context.repo.owner,
              repo: context.repo.repo,
              workflow_id: 'release.yml',
              ref: 'main',
              inputs: {
                release_mode: '${{ github.event.inputs.release_mode }}',
                bump_type: '${{ github.event.inputs.bump_type }}',
                description: '${{ github.event.inputs.description }}'
              }
            });
            console.log('Triggered CI/CD workflow with your inputs.');
